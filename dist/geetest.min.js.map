{"version":3,"file":"geetest.min.js","sources":["../src/geetest.jsx"],"sourcesContent":["import React from 'react';\n// import PropTypes from 'prop-types';\n\nexport default class Geetest extends React.Component {\n  // static propTypes = {\n  //   gt: PropTypes.string.isRequired,\n  //   challenge: PropTypes.string.isRequired,\n  //   success: PropTypes.number.isRequired,\n  //   https: PropTypes.bool,\n  //   product: PropTypes.string,\n  //   lang: PropTypes.string,\n  //   sandbox: PropTypes.bool,\n  //   width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  //   onReady: PropTypes.func,\n  //   onSuccess: PropTypes.func,\n  //   onError: PropTypes.func,\n  //   onClose: PropTypes.func\n  // }\n\n  static defaultProps = {\n    https: false,\n    product: 'popup',\n    lang: 'zh-cn',\n    sandbox: false,\n    width: '300px',\n    onReady: () => {},\n    onSuccess: () => {},\n    onError: () => {},\n    onClose: () => {}\n  }\n\n  constructor(props) {\n    super(props);\n    this.dom = null;\n    this.state = {\n      ins: null,\n      script: null\n    };\n  }\n\n  // componentWillMount() {\n  //   const that = this;\n  //   console.log('componentWillMount', that.props, that.state);\n  // }\n\n  componentDidMount() {\n    const that = this;\n    // console.log('componentDidMount', that.props, that.state);\n    that.init();\n  }\n\n  // componentWillReceiveProps(nextProps) {\n  //   const that = this;\n  //   console.log('componentWillReceiveProps', that.props, nextProps);\n  // }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    const that = this;\n    // console.log('shouldComponentUpdate', that.props, nextProps, that.state, nextState);\n    return (nextProps.challenge !== that.props.challenge);\n  }\n\n  // componentWillUpdate(nextProps, nextState) {\n  //   const that = this;\n  //   console.log('componentWillUpdate', that.props, nextProps, that.state, nextState);\n  // }\n\n  componentDidUpdate(prevProps, prevState) {\n    const that = this;\n    // console.log('componentDidUpdate', prevProps, that.props, prevState, that.state);\n    that.init();\n  }\n\n  componentWillUnmount() {\n    const that = this;\n    // console.log('componentWillUnmount', that.props, that.state);\n    that.destroy();\n  }\n\n  init = () => {\n    const that = this;\n    // console.log('_init');\n\n    if (window.initGeetest) {\n      that.ready();\n      return;\n    }\n\n    const ds = document.createElement('script');\n    ds.type = 'text/javascript';\n    ds.async = true;\n    ds.charset = 'utf-8';\n\n    if (ds.readyState) {\n      ds.onreadystatechange = () => {\n        if (ds.readyState === 'loaded' || ds.readyState === 'complete') {\n          ds.onreadystatechange = null;\n          that.ready();\n        }\n      };\n    } else {\n      ds.onload = () => {\n        ds.onload = null;\n        that.ready();\n      };\n    }\n\n    ds.src = `${document.location.protocol}//static.geetest.com/static/tools/gt.js?_t=${(new Date()).getTime()}`;\n    const s = document.getElementsByTagName('script')[0];\n    s.parentNode.insertBefore(ds, s);\n\n    that.setState({\n      script: ds\n    });\n  }\n\n  ready = () => {\n    const that = this;\n    // console.log('_ready');\n    const {\n      gt,\n      challenge,\n      https,\n      product,\n      lang,\n      sandbox,\n      width,\n      success\n    } = that.props;\n    const { ins } = that.state;\n\n    if (!window.initGeetest) {\n      return;\n    }\n\n    if (ins) {\n      that.load(ins);\n      return;\n    }\n\n    window.initGeetest({\n      gt,\n      challenge,\n      https,\n      product,\n      lang,\n      sandbox,\n      width,\n      offline: !success,\n      new_captcha: true\n    }, (geetest) => {\n      that.load(geetest);\n\n      that.setState({\n        ins: geetest\n      });\n    });\n  }\n\n  load = (ins) => {\n    const that = this;\n    // console.log('_load');\n\n    if (!that.dom) {\n      return;\n    }\n\n    const {\n      onReady,\n      onSuccess,\n      onError,\n      onClose\n    } = that.props;\n\n    ins.appendTo(that.dom);\n    ins.onReady(onReady);\n    ins.onSuccess(() => onSuccess(ins.getValidate()));\n    ins.onError(onError);\n    ins.onClose(onClose);\n  }\n\n  destroy = () => {\n    const that = this;\n    // that.state.script.parentNode.removeChild(that.state.script);\n    that.setState({\n      ins: null,\n      script: null\n    });\n  }\n\n  render() {\n    const that = this;\n    // console.log('render');\n    const { challenge } = that.props;\n\n    return (\n      <div\n        className=\"i-geetest\"\n        key={challenge}\n        ref={(e) => {that.dom = e;}}\n      />\n    );\n  }\n}\n"],"names":["Geetest","props","that","window","initGeetest","ready","ds","document","createElement","type","async","charset","readyState","onreadystatechange","onload","src","location","protocol","Date","getTime","s","getElementsByTagName","parentNode","insertBefore","setState","script","gt","challenge","https","product","lang","sandbox","width","success","ins","state","load","offline","new_captcha","geetest","dom","onReady","onSuccess","onError","onClose","appendTo","getValidate","React","Component","this","init","nextProps","nextState","prevProps","prevState","destroy","className","key","ref","e"],"mappings":"43BAGqBA,yBA4BPC,iJACJA,0EA+CD,eACCC,aAGFC,OAAOC,YACTF,EAAKG,iBAIDC,EAAKC,SAASC,cAAc,UAClCF,EAAGG,KAAO,kBACVH,EAAGI,OAAQ,EACXJ,EAAGK,QAAU,QAETL,EAAGM,WACLN,EAAGO,mBAAqB,WACA,WAAlBP,EAAGM,YAA6C,aAAlBN,EAAGM,aACnCN,EAAGO,mBAAqB,KACxBX,EAAKG,UAITC,EAAGQ,OAAS,WACVR,EAAGQ,OAAS,KACZZ,EAAKG,SAITC,EAAGS,cAASR,SAASS,SAASC,gEAAuD,IAAIC,MAAQC,eAC3FC,EAAIb,SAASc,qBAAqB,UAAU,GAClDD,EAAEE,WAAWC,aAAajB,EAAIc,GAE9BlB,EAAKsB,SAAS,CACZC,OAAQnB,yBAIJ,eACAJ,YAWFA,EAAKD,MARPyB,IAAAA,GACAC,IAAAA,UACAC,IAAAA,MACAC,IAAAA,QACAC,IAAAA,KACAC,IAAAA,QACAC,IAAAA,MACAC,IAAAA,QAEMC,EAAQhC,EAAKiC,MAAbD,IAEH/B,OAAOC,cAIR8B,EACFhC,EAAKkC,KAAKF,GAIZ/B,OAAOC,YAAY,CACjBsB,GAAAA,EACAC,UAAAA,EACAC,MAAAA,EACAC,QAAAA,EACAC,KAAAA,EACAC,QAAAA,EACAC,MAAAA,EACAK,SAAUJ,EACVK,aAAa,GACZ,SAACC,GACFrC,EAAKkC,KAAKG,GAEVrC,EAAKsB,SAAS,CACZU,IAAKK,0BAKJ,SAACL,OACAhC,aAGDA,EAAKsC,WASNtC,EAAKD,MAJPwC,IAAAA,QACAC,IAAAA,UACAC,IAAAA,QACAC,IAAAA,QAGFV,EAAIW,SAAS3C,EAAKsC,KAClBN,EAAIO,QAAQA,GACZP,EAAIQ,UAAU,kBAAMA,EAAUR,EAAIY,iBAClCZ,EAAIS,QAAQA,GACZT,EAAIU,QAAQA,0BAGJ,mBAGHpB,SAAS,CACZU,IAAK,KACLT,OAAQ,WAzJLe,IAAM,OACNL,MAAQ,CACXD,IAAK,KACLT,OAAQ,8PAjCuBsB,EAAMC,6DA2C1BC,KAERC,qDAQeC,EAAWC,UAGvBD,EAAUxB,YAFLsB,KAEwBhD,MAAM0B,qDAQ1B0B,EAAWC,GACfL,KAERC,sDAIQD,KAERM,+CAmHCrD,EAAO+C,KAELtB,EAAczB,EAAKD,MAAnB0B,iBAGNoB,uBACES,UAAU,YACVC,IAAK9B,EACL+B,IAAK,SAACC,GAAOzD,EAAKsC,IAAMmB,mDApMX3D,iBAgBG,CACpB4B,OAAO,EACPC,QAAS,QACTC,KAAM,QACNC,SAAS,EACTC,MAAO,QACPS,QAAS,aACTC,UAAW,aACXC,QAAS,aACTC,QAAS"}